!function(){function define(t){let e=t.is;customElements.get(e)?console.warn("Already registered "+e):customElements.define(e,t)}const disabled="disabled";function XtallatX(t){return class extends t{constructor(){super(...arguments),this._evCount={}}static get observedAttributes(){return[disabled]}get disabled(){return this._disabled}set disabled(t){this.attr(disabled,t,"")}attr(t,e,s){this[(e?"set":"remove")+"Attribute"](t,s||e)}to$(t){const e=t%2;return(t-e)/2+"-"+e}incAttr(t){const e=this._evCount;t in e?e[t]++:e[t]=0,this.attr("data-"+t,this.to$(e[t]))}attributeChangedCallback(t,e,s){switch(t){case disabled:this._disabled=null!==s}}de(t,e,s=!1){const i=t+(s?"":"-changed"),n=new CustomEvent(i,{detail:e,bubbles:!0,composed:!1});return this.dispatchEvent(n),this.incAttr(i),n}_upgradeProperties(t){t.forEach(t=>{if(this.hasOwnProperty(t)){let e=this[t];delete this[t],this[t]=e}})}}}function getHost(t){let e=t;for(;e=e.parentNode;){if(11===e.nodeType)return e.host;if("BODY"===e.tagName)return null}return null}const history_state_update="history-state-update";function getIFrmWin(t,e){let s=t.querySelector("iframe[xtal-state]");return null===s?((s=document.createElement("iframe")).setAttribute("xtal-state",""),s.addEventListener("load",()=>{s.setAttribute("loaded",""),null!==e&&e(s)}),s.src="blank.html",s.style.display="none",t.appendChild(s)):s.hasAttribute("loaded")?null!==e&&e(s):s.addEventListener("load",()=>{null!==e&&e(s)}),s.contentWindow}function getMchPar(t,e){let s=t.parentElement;for(;s;){if(s.matches(e))return s;s=s.parentElement}}function getSC(t){const e=getHost(t);return null===e.shadowRoot?e:e.shadowRoot}function getWinCtx(t,e){return new Promise((s,i)=>{switch(e){case"global":init(self),s(self);break;case"local":getIFrmWin(t.parentElement,t=>{init(t.contentWindow),s(t.contentWindow)});break;case"shadow":getIFrmWin(getSC(t),t=>{init(t.contentWindow),s(t.contentWindow)});break;default:getIFrmWin(getMchPar(t,e),t=>{init(t.contentWindow),s(t.contentWindow)})}})}function de(t,e){const s={oldState:t,newState:e.history.state,initVal:!1},i=e.__xtalStateInfo;i.hasStarted||(i.hasStarted=!0,i.startedAsNull&&(s.initVal=!0));const n=new CustomEvent(history_state_update,{detail:s,bubbles:!0,composed:!0});e.dispatchEvent(n)}function init(t){if(t.__xtalStateInit)return;t.__xtalStateInit=!0,t.__xtalStateInfo||(t.__xtalStateInfo={startedAsNull:null===t.history.state});const e=t.history.pushState.bind(t.history);t.history.pushState=function(s,i,n){const r=t.history.state;e(s,i,n),de(r,t)};const s=t.history.replaceState.bind(t.history);t.history.replaceState=function(e,i,n){const r=t.history.state;s(e,i,n),de(r,t)}}const level="level";class XtalStateBase extends(XtallatX(HTMLElement)){constructor(){super(...arguments),this._level="global"}get level(){return this._level}set level(t){this.attr(level,t)}static get observedAttributes(){return super.observedAttributes.concat([level])}get window(){return this._window}attributeChangedCallback(t,e,s){switch(super.attributeChangedCallback(t,e,s),t){case level:this._level=s}this.onPropsChange()}connectedCallback(){this.style.display="none",this._upgradeProperties(["disabled",level]),this._conn=!0,this.onPropsChange()}onPropsChange(){return!(this._conn&&!this._disabled)||(this._window||(this._notReady=!0,getWinCtx(this,this._level).then(t=>{this._window=t,this._notReady=!1})),!!this._notReady||void 0)}}const watch="watch",all="all",xtal_subscribers="xtal-subscribers",popstate="popstate";function remove(t,e){const s=t.indexOf(e);-1!==s&&t.splice(s,1)}class XtalStateWatch extends XtalStateBase{static get is(){return"xtal-state-watch"}static get observedAttributes(){return super.observedAttributes.concat([watch])}attributeChangedCallback(t,e,s){switch(super.attributeChangedCallback(t,e,s),t){case watch:this._watch=""===s?all:popstate}this.notify()}pushReplaceHandler(t){this._window;t.detail.initVal?(this.dataset.historyInit="true",this.dataset.popstate="true"):(delete this.dataset.popstate,delete this.dataset.historyInit),this.history=this._window.history.state}popStateHandler(t){this.dataset.popstate="true",this.history=this._window.history.state}addSubscribers(){if(this._notReady)setTimeout(()=>{this.addSubscribers()},50);else{switch(this._watch){case all:case popstate:this._boundPushReplaceListener||(this._boundPushReplaceListener=this.pushReplaceHandler.bind(this),this._window.addEventListener(history_state_update,this._boundPushReplaceListener))}switch(this._watch){case popstate:this._boundPopStateListener||(this._boundPopStateListener=this.popStateHandler.bind(this),this._window.addEventListener(popstate,this._boundPopStateListener))}this._connected=!0,this.history=this._window.history.state}}connectedCallback(){this._upgradeProperties([watch]),super.connectedCallback(),this.addSubscribers()}disconnect(){this._boundPopStateListener&&this.removeEventListener(popstate,this._boundPopStateListener),this._boundPushReplaceListener&&this.removeEventListener(history_state_update,this._boundPushReplaceListener)}disconnectedCallback(){this.disconnect()}get history(){return this._history}set history(t){this._history=t,this._watch&&this.notify()}get watch(){return this._watch}set watch(t){this.attr(watch,t)}notify(){this._watch&&!this._disabled&&this._connected&&void 0!==this._history&&null!==this._history&&this.de("history",{value:this._history})}}define(XtalStateWatch);const url="url",url_search="url-search",replace_url_value="replace-url-value";function UrlFormatter(t){return class extends t{get url(){return this._url}set url(t){this.attr(url,t)}get urlSearch(){return this._urlSearch}set urlSearch(t){this.attr(url_search,t)}get replaceUrlValue(){return this._replaceUrlValue}set replaceUrlValue(t){this.attr(replace_url_value,t)}get stringifyFn(){return this._stringifyFn}set stringifyFn(t){this._stringifyFn=t}static get UFAttribs(){return[url,url_search,replace_url_value]}attributeChangedCallback(t,e,s){switch(t){case url:this["_"+t]=s;break;case url_search:this._urlSearch=s;break;case replace_url_value:this._replaceUrlValue=s}super.attributeChangedCallback&&super.attributeChangedCallback(t,e,s)}connectedCallback(){this._upgradeProperties([url,"urlSearch","replaceUrlValue","stringifyFn"]),super.connectedCallback&&super.connectedCallback()}adjustUrl(t){if(this._stringifyFn)t=this._stringifyFn(this);else if(this._replaceUrlValue&&this._urlSearch){const e=new RegExp(this._urlSearch);t=t.replace(e,this._replaceUrlValue)}return t}}}function mergeDeep(t,e){if("object"==typeof t&&"object"==typeof e){for(const s in e){const i=e[s],n=t[s];if(i)if(n)switch(typeof i){case"object":switch(typeof n){case"object":mergeDeep(n,i);break;default:t[s]=i}break;default:t[s]=i}else t[s]=i}return t}}function observeCssSelector(t){const e=["animationstart","MSAnimationStart","webkitAnimationStart"];return class extends t{addCSSListener(t,s,i){if(this._boundInsertListener)return;const n=`\n            @keyframes ${t} {\n                from {\n                    opacity: 0.99;\n                }\n                to {\n                    opacity: 1;\n                }\n            }\n    \n            ${s}{\n                animation-duration: 0.001s;\n                animation-name: ${t};\n            }\n            `,r=document.createElement("style");r.innerHTML=n;const a=getHost(this);null!==a?a.shadowRoot.appendChild(r):document.body.appendChild(r),this._boundInsertListener=i.bind(this);const o=a?a.shadowRoot:document;e.forEach(t=>{o.addEventListener(t,this._boundInsertListener,!1)})}disconnectedCallback(){if(this._boundInsertListener){const t=getHost(this),s=t?t.shadowRoot:document;e.forEach(t=>{s.removeEventListener(t,this._boundInsertListener)})}void 0!==super.disconnectedCallback&&super.disconnectedCallback()}}}function createNestedProp(t,e,s,i){const n=e.shift(),r=t[n],a={[n]:r||{}};let o=a[n];const l=e.pop();if(e.forEach(t=>{let e=o[t];e||(e=o[t]={}),o=e}),o[l]&&"object"==typeof s?Object.assign(o[l],s):void 0===l?a[n]=s:o[l]=s,i)try{Object.assign(t,a)}catch(t){}}class Bist extends(UrlFormatter(observeCssSelector(XtalStateWatch))){static get is(){return"bi-st"}constructor(){super()}connectedCallback(){this.style.display="none",this.watch="popstate",this._disabled||(this.getElement("_script",t=>t.querySelector("script")),super.connectedCallback(),getWinCtx(this,this.level).then(t=>{this.addEventListener("history-changed",this.histChgListener);const e=t;null!==t.history.state&&this.sync(e)}))}static get observedAttributes(){return super.observedAttributes.concat(super.UFAttribs)}getElement(t,e){this[t]=e(this),this[t]?this.evaluateCode(this._script):setTimeout(()=>{this.getElement(t,e)},50)}evaluateCode(scriptElement){this._rules=eval(scriptElement.innerHTML);const sel=Object.keys(this._rules).join(",");this.addCSSListener(Bist.is,sel,this.insertListener)}insertListener(t){if(t.animationName===Bist.is){const e=t.target;setTimeout(()=>{this.regListener(e)},0)}}histChgListener(t){this.sync(this._window)}sync(t){this.value=t.history.state,this.de("sync-history",{value:this.value},!0)}regListener(t){for(const e in this._rules)if(t.matches(e)){const s=this._rules[e];if(s.onPopState&&(this.addEventListener("history-changed",e=>{s.onPopState(this,t)}),null!==this._window.history.state&&s.onPopState(this,t)),s.on)for(const e in s.on){const i=s.on[e],n=this;t.addEventListener(e,t=>{i(t,n)})}}}merge(t,e,s){const i=this._window.history,n=i.state||{},r=(Object.assign({},n),{});createNestedProp(r,t.split("."),e,!0),mergeDeep(n,r),this.value=n,this.de("sync-history",{value:n},!0);const a=this.adjustUrl(this._url);i[s+"State"](n,"",a)}pullFromPath(t,e){let s=this._window.history.state;if(null===s)return e;const i=t.split(".");for(let t=0,n=i.length;t<n;t++){if(null==(s=s[i[t]]))return e}return s}get url(){return this._url}set url(t){this._url=t}}define(Bist)}();